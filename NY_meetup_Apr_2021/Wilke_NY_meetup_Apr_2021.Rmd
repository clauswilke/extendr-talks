---
title: "The extendr project: Integrating R and Rust"
author: "Claus O. Wilke"
date: "last updated: `r Sys.Date()`"
params:
  compile_rust: FALSE
output:
  xaringan::moon_reader:
    css: [default, "Wilke-slides-theme.css"]
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      slideNumberFormat: ''
      titleSlideClass: [center, middle]
---

```{r setup, include=FALSE, echo=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(comment = "")
library(rextendr)
```

## We're dealing with two distinct pieces

--

<img src = "resources/extendr-logo.svg", width = 20%, style = "vertical-align: middle;" /> **extendr:** Rust crate providing bindings to R

--

<img src = "resources/rextendr-hexlogo.svg", width = 15%, style = "vertical-align: middle; margin-left: 2.5%; margin-right: 2.5%;" /> **rextendr:** R package providing support for the extendr crate


???

The extendr logo and hexlogo are distributed under the terms of the [Creative Commons Attribution-ShareAlike 4.0 International license](https://creativecommons.org/licenses/by-sa/4.0/) (CC-BY-SA 4.0).

[The R logo](https://www.r-project.org/logo/) by The R Foundation is licensed under [CC-BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/).

[The Rust logo](https://github.com/rust-lang/rust-artwork) by Rust Foundation is licensed under [CC-BY 4.0](https://creativecommons.org/licenses/by/4.0/).

---

## Partners in crime

<img src = "https://avatars.githubusercontent.com/u/1556316", width = "15%" /> &nbsp;&nbsp;&nbsp; [Andy Thomason](https://github.com/andy-thomason)

--

<img src = "https://avatars.githubusercontent.com/u/8782986", width = "10%" /> &nbsp;&nbsp;&nbsp; [Ilia Kosenkov](https://github.com/Ilia-Kosenkov)
<img src = "https://avatars.githubusercontent.com/u/1978793", width = "10%", style = "margin-left: .5in;"/> &nbsp;&nbsp;&nbsp; [Hiroaki Yutani](https://github.com/yutannihilation)
<img src = "https://avatars.githubusercontent.com/u/4706822
", width = "10%", style = "margin-left: .5in;"/> &nbsp;&nbsp;&nbsp; [Daniel Falbel](https://github.com/dfalbel)


and [many others](https://github.com/extendr/extendr/graphs/contributors)


---

## Benefits of Rust

--

- Compiled, performance of C

--

- Compiler protects against undefined behavior

--

- Modern abstractions: generics, containers, functional programming

--

- Powerful macro programming language

--

- Integrated build environment, dependency management

--

- Built-in framework for unit tests

--

- Built-in framework for documentation and distribution

--

## but ...


---
background-image: url("https://source.unsplash.com/_37crDvsAqE/")
background-position: right
background-size: contain

# <br>Learning Rust can be<br>a steep climb

???

Photo credit:  
[Tommy Lisbin](https://unsplash.com/@tlisbin)  
https://unsplash.com/photos/_37crDvsAqE

---

background-image: url("resources/code-screenshot.png")
background-position: right
background-size: 65%

# <br>It's just like C++?


---

## A simple Rust program: Multiples of 3 and 5

.tiny-font[
```rust
fn main() {
    let x = 1..;  // all integers from 1 to infininity
    
    let y:Vec<_> = x
        .into_iter() // convert to iterator
        .filter(     // filter out numbers divisible by 3 or 5
            |z| z % 3 == 0 || z % 5 == 0
        )
        .take(10)    // keep the first 10
        .collect();  // collect into vector
        
    println!("{:?}", y);
    //println!("{:?}", x);
}
```
]

Try it on the [Rust Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=ae012e466928d5adbb68b86ac7ffb43f)

---

## Fizzbuzz in Rust

.tiny-font[
```rust
fn buzz(i: i32) -> (i32, Option<&'static str>) {
    match (i % 3, i % 5) {
        (0, 0) => (i, Some("FizzBuzz")),
        (0, _) => (i, Some("Fizz")),
        (_, 0) => (i, Some("Buzz")),
        (_, _) => (i, None),
    }
}

fn main() {
    for i in 1..16 {
        println!("{:?}", buzz(i));
    }
}
```
]

Try it on the [Rust Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=00850f854bfb5a8248a9b506358662a2)

---

## Combining the two previous examples

.xtiny-font[
```rust
fn buzz(i: i32) -> (i32, Option<&'static str>) {
    match (i % 3, i % 5) {
        (0, 0) => (i, Some("FizzBuzz")),
        (0, _) => (i, Some("Fizz")),
        (_, 0) => (i, Some("Buzz")),
        (_, _) => (i, None),
    }
}

fn main() {
    let y: Vec<_> = (1..)
        .into_iter() // convert to iterator
        .map(buzz)   // run `buzz()` over each integer
        .filter(     // retain interesting cases
            |z| z.1.is_some(),
        )
        .take(10)    // keep the first 10
        .collect();  // collect into vector

    println!("{:?}", y);
}
```
]

Try it on the [Rust Playground](https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=0984382148c0680b31bdf024981c0e7f)

---

<style>
.move-down { margin-top: 9em; }
</style>

.move-down[
## You don't need **rextendr** to write R packages using Rust
]

--

(But it'll make your life easier)

---
class: middle center

## Why you want to use R Markdown as a Rust developer

---

## How about executing compiled Rust code in your xaringan presentation?

--

.pull-left[

**RMarkdown input**

.tiny-font[
````markdown
`r ''````{extendr}
let x = 5;
let y = 7;
let z = x*y;

assert_eq!(z, 35);
```
````
]]

--

.pull-right[
**Rendered output**

.tiny-font[
```{extendr eval = params$compile_rust}
let x = 5;
let y = 7;
let z = x*y;

assert_eq!(z, 35);
```
]]

--

How do we know this actually got compiled and run?

---

## How about executing compiled Rust code in your xaringan presentation?

.pull-left[

**RMarkdown input**

.tiny-font[
````markdown
`r ''````{extendr}
let x = 5;
let y = 7;
let z = x*y;

assert_eq!(z, 35);

// No semicolon,
// value is returned to R
z
```
````
]]


.pull-right[
**Rendered output**

.tiny-font[
```{extendr eval = params$compile_rust}
let x = 5;
let y = 7;
let z = x*y;

assert_eq!(z, 35);

// No semicolon,
// value is returned to R
z
```
]]


---

## Chaining multiple Rust chunks together

--

.pull-left[

**RMarkdown input**

.tiny-font[
````markdown
Define variable `x`:

`r ''````{extendr A, eval = FALSE}
let x = 1;
```

Define variable `y`:

`r ''````{extendr B, eval = FALSE}
let y = 2;
```

Print:

`r ''````{extendr out, preamble = c("A", "B")}
rprintln!("x = {}, y = {}", x, y);
```
````
]]

--

.pull-right[

**Rendered output**

.tiny-font[

Define variable `x`:

```{extendr chunk_x, eval = FALSE}
let x = 1;
```

Define variable `y`:

```{extendr chunk_y, eval = FALSE}
let y = 2;
```

Print:

```{extendr out, eval = params$compile_rust, preamble = c("chunk_x", "chunk_y")}
rprintln!("x = {}, y = {}", x, y);
```
]]



---

## Calling Rust code from R

--

.pull-left.tiny-font[
```{extendrsrc eval = params$compile_rust}
#[extendr]
fn add_float(x: f64, y: f64) -> f64 {
    x + y
}

struct Counter {
    n: i32,
}

#[extendr]
impl Counter {
    fn new() -> Self { Self { n: 0 } }
    
    fn increment(&mut self) { self.n += 1; }
    
    fn get(&self) -> i32 { self.n }
}
```
]

--

.pull-right.tiny-font[
```{r eval = params$compile_rust}
add_float(34.5, 64.2)

x <- Counter$new()
x$get()
x$increment()
x$increment()
x$get()
```
]


---

## Resources

- **extendr**
  - [Release on crates.io](https://crates.io/crates/extendr-api)
  - [Documentation (released version)](https://docs.rs/extendr-api/)
  - [Documentation (in development)](https://extendr.github.io/extendr/extendr_api/)
  - [Source repository](https://github.com/extendr/extendr)
- **rextendr**
  - Release on CRAN: coming soon
  - [Pakackge website](https://extendr.github.io/rextendr/)
  - [Source repository](https://github.com/extendr/rextendr)


